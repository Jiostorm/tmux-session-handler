#!/bin/bash

tab=$(printf '\t')

fzf_x=$(get_opts "@tmux_fzf_x" 0)
fzf_y=$(get_opts "@tmux_fzf_y" "#{window_height}")
fzf_width=$(get_opts "@tmux_fzf_width" 45)
fzf_height=$(get_opts "@tmux_fzf_height" 15)
session_keybind=$(get_opts "@tmux_fzf_session_keybind" "M-s")
window_keybind=$(get_opts "@tmux_fzf_window_keybind" "M-w")
session_format=$(get_opts "@tmux_fzf_session_format" "#{p8:[#{session_windows}]}#S")
window_format=$(get_opts "@tmux_fzf_window_format" "#S:#{p8:#{window_index}}${tab}[#W]")

fzfer="fzf --layout default"
switcher="xargs -I{} tmux switch -t {}"

tmux bind "$session_keybind" display-popup -E -B -w "$fzf_width" -h "$fzf_height" -x "$fzf_x" -y "$fzf_y" "tmux ls -F '$session_format' | $fzfer | awk '{ print \$2 }' | $switcher"
tmux bind "$window_keybind" display-popup -E -B -w "$fzf_width" -h "$fzf_height" -x "$fzf_x" -y "$fzf_y" "tmux lsw -a -F '$window_format' | $fzfer | awk '{ print \$1 }' | $switcher"
